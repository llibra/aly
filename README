aly - Trivial Lisp parser combinator library
============================================

概要
----

パーサコンビネータライブラリです。Shibuya.lisp TT #6の鹿野さんの「多値で簡単パー
サーコンビネーター」に影響されて作りました。遅延ストリームのアイデアは Gauche の
PEGモジュールからいただきました。

まだ作りかけなので、欠けている機能が多いです。最適化もしていないので、速度も遅い
です。

使用例
------

最初にライブラリを読み込みます。

    (asdf:load-system :aly)

パーサを定義します。パーサはストリームを引数に取り、結果と処理後のストリームを多
値で返します。

    (defun additive ()
      (flet ((f1 (stream)
               (aly:with-context (s stream)
                   ((v1 (multitive))
                    (_ (aly:specific-char #\+))
                    (v2 (additive)))
                 (values (+ v1 v2) s)))
             (f2 (stream)
               (aly:with-context (s stream)
                   ((v1 (multitive))
                    (_ (aly:specific-char #\-))
                    (v2 (additive)))
                 (values (- v1 v2) s))))
        (aly:choice (aly:try #'f1)
                    (aly:try #'f2)
                    (multitive))))
    
    (defun multitive ()
      (flet ((f1 (stream)
               (aly:with-context (s stream)
                   ((v1 (primary))
                    (_ (aly:specific-char #\*))
                    (v2 (multitive)))
                 (values (* v1 v2) s)))
             (f2 (stream)
               (aly:with-context (s stream)
                   ((v1 (primary))
                    (_ (aly:specific-char #\/))
                    (v2 (multitive)))
                 (values (/ v1 v2) s))))
      (aly:choice (aly:try #'f1)
                  (aly:try #'f2)
                  (primary))))
    
    (defun primary ()
      (flet ((f (stream)
               (aly:with-context (s stream)
                   ((kakko (aly:specific-char #\())
                    (r (additive))
                    (kokka (aly:specific-char #\))))
                 (values r s))))
        (aly:choice (aly:try #'f) (decimal))))
    
    (defun decimal ()
      (lambda (stream)
        (aly:with-context (s stream)
            ((c (aly:digit)))
          (let ((r (read-from-string (princ-to-string c))))
            (values r s)))))

パーサを実行します。

    (aly:parse (additive) "1+2")
    ;; =>  3, NIL
    (aly:parse (additive) "4*2-((3+1)-(9/3))*2")
    ;; =>  6, NIL
    (aly:parse (additive) "4**2-3/5")
    ;; >>  Error

ドキュメントがないので、それぞれの関数の使い方については、t/以下にあるテストを見
てください。
